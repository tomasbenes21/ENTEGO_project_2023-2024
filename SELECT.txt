SELECT
ttbpspf.industry_name,
ttbpspf2.total_value AS '2006',
ttbpspf3.total_value AS '2007',
ttbpspf4.total_value AS '2008',
ttbpspf5.total_value AS '2009',
ttbpspf6.total_value AS '2010',
ttbpspf7.total_value AS '2011',
ttbpspf8.total_value AS '2012',
ttbpspf9.total_value AS '2013',
ttbpspf10.total_value AS '2014',
ttbpspf11.total_value AS '2015',
ttbpspf12.total_value AS '2016',
ttbpspf13.total_value AS '2017',
ttbpspf14.total_value AS '2018'
FROM t_tomas_benes_project_sql_primary_final ttbpspf
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf2
	ON ttbpspf2.industry_name = ttbpspf.industry_name
	AND ttbpspf2.payroll_year = 2006
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf3
	ON ttbpspf3.industry_name = ttbpspf.industry_name
	AND ttbpspf3.payroll_year = 2007
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf4
	ON ttbpspf4.industry_name = ttbpspf.industry_name
	AND ttbpspf4.payroll_year = 2008
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf5
	ON ttbpspf5.industry_name = ttbpspf.industry_name
	AND ttbpspf5.payroll_year = 2009
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf6
	ON ttbpspf6.industry_name = ttbpspf.industry_name
	AND ttbpspf6.payroll_year = 2010
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf7
	ON ttbpspf7.industry_name = ttbpspf.industry_name
	AND ttbpspf7.payroll_year = 2011
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf8
	ON ttbpspf8.industry_name = ttbpspf.industry_name
	AND ttbpspf8.payroll_year = 2012
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf9
	ON ttbpspf9.industry_name = ttbpspf.industry_name
	AND ttbpspf9.payroll_year = 2013
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf10
	ON ttbpspf10.industry_name = ttbpspf.industry_name
	AND ttbpspf10.payroll_year = 2014
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf11
	ON ttbpspf11.industry_name = ttbpspf.industry_name
	AND ttbpspf11.payroll_year = 2015
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf12
	ON ttbpspf12.industry_name = ttbpspf.industry_name
	AND ttbpspf12.payroll_year = 2016
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf13
	ON ttbpspf13.industry_name = ttbpspf.industry_name
	AND ttbpspf13.payroll_year = 2017
LEFT JOIN t_tomas_benes_project_sql_primary_final ttbpspf14
	ON ttbpspf14.industry_name = ttbpspf.industry_name
	AND ttbpspf14.payroll_year = 2018



CREATE TABLE t_tomas_benes_project_SQL_primary_final
WITH price AS (
	SELECT
	cp.id AS czechia_price_ID, 
	round(sum(cp.value),2) AS unit_value,
	cpc.code AS cat_code,
	cpc.name AS category_name,
	cpc.price_value,
	cpc.price_unit,
	YEAR(cp.date_from) AS czechia_price_year
	FROM czechia_price cp
	LEFT JOIN czechia_price_category cpc
	ON cpc.code=cp.category_code
	LEFT JOIN czechia_region cr
	ON cr.code=cp.region_code
	AND cp.region_code IS NULL
	GROUP BY cp.id, category_code, cpc.name, cpc.price_value, cpc.price_unit, YEAR(cp.date_from)
	ORDER BY cp.date_from
	)
SELECT *
FROM price
LEFT JOIN (
	SELECT
	cpa.id AS czechia_payroll_ID,
	sum(cpa.value) AS total_value,
	cpvt.name AS value_name,
	cpu.name AS unit_name,
	cpa.industry_branch_code AS industry_code,
	cpib.name AS industry_name,
	cpa.payroll_year
FROM czechia_payroll cpa
LEFT JOIN czechia_payroll_calculation cpc
	ON cpc.code=cpa.calculation_code
LEFT JOIN czechia_payroll_industry_branch cpib
	ON cpib.code=cpa.industry_branch_code
LEFT JOIN czechia_payroll_unit cpu
	ON cpu.code=cpa.unit_code
LEFT JOIN czechia_payroll_value_type cpvt
	ON cpvt.code=cpa.value_type_code
GROUP BY cpa.id, cpvt.name, cpa.industry_branch_code, cpib.name, cpa.payroll_year
) pay
ON price.czechia_price_year = pay.payroll_year;





CREATE TABLE t_tomas_benes_project_sql_primary_final2
WITH price AS (
	SELECT
	cp.id AS czechia_price_ID, 
	cp.value AS unit_value,
	cpc.code AS cat_code,
	cpc.name AS category_name,
	cpc.price_value,
	cpc.price_unit,
	YEAR(cp.date_from) AS czechia_price_year
	FROM czechia_price cp
	LEFT JOIN czechia_price_category cpc
	ON cpc.code=cp.category_code
	LEFT JOIN czechia_region cr
	ON cr.code=cp.region_code
	AND cp.region_code IS NULL
	GROUP BY cp.id, category_code, cpc.name, cpc.price_value, cpc.price_unit, YEAR(cp.date_from)
	ORDER BY cp.date_from
	)
SELECT *
FROM price
LEFT JOIN (
	SELECT
	cpa.id AS czechia_payroll_ID,
	cpa.value AS payroll_value,
	cpvt.name AS value_name,
	cpu.name AS unit_name,
	cpa.industry_branch_code AS industry_code,
	cpib.name AS industry_name,
	cpa.payroll_year
FROM czechia_payroll cpa
LEFT JOIN czechia_payroll_calculation cpc
	ON cpc.code=cpa.calculation_code
LEFT JOIN czechia_payroll_industry_branch cpib
	ON cpib.code=cpa.industry_branch_code
LEFT JOIN czechia_payroll_unit cpu
	ON cpu.code=cpa.unit_code
LEFT JOIN czechia_payroll_value_type cpvt
	ON cpvt.code=cpa.value_type_code
) pay
ON price.czechia_price_year = pay.payroll_year;